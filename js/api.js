!function () { "use strict"; function t(n, i, a, c) { return new (a || (a = Promise))(function (e, t) { function r(e) { try { o(c.next(e)) } catch (e) { t(e) } } function s(e) { try { o(c.throw(e)) } catch (e) { t(e) } } function o(t) { t.done ? e(t.value) : new a(function (e) { e(t.value) }).then(r, s) } o((c = c.apply(n, i || [])).next()) }) } function h(r, s) { var o, n, i, e, a = { label: 0, sent: function () { if (1 & i[0]) throw i[1]; return i[1] }, trys: [], ops: [] }; return e = { next: t(0), throw: t(1), return: t(2) }, "function" == typeof Symbol && (e[Symbol.iterator] = function () { return this }), e; function t(t) { return function (e) { return function (t) { if (o) throw new TypeError("Generator is already executing."); for (; a;)try { if (o = 1, n && (i = 2 & t[0] ? n.return : t[0] ? n.throw || ((i = n.return) && i.call(n), 0) : n.next) && !(i = i.call(n, t[1])).done) return i; switch (n = 0, i && (t = [2 & t[0], i.value]), t[0]) { case 0: case 1: i = t; break; case 4: return a.label++, { value: t[1], done: !1 }; case 5: a.label++, n = t[1], t = [0]; continue; case 7: t = a.ops.pop(), a.trys.pop(); continue; default: if (!(i = 0 < (i = a.trys).length && i[i.length - 1]) && (6 === t[0] || 2 === t[0])) { a = 0; continue } if (3 === t[0] && (!i || t[1] > i[0] && t[1] < i[3])) { a.label = t[1]; break } if (6 === t[0] && a.label < i[1]) { a.label = i[1], i = t; break } if (i && a.label < i[2]) { a.label = i[2], a.ops.push(t); break } i[2] && a.ops.pop(), a.trys.pop(); continue }t = s.call(r, a) } catch (e) { t = [6, e], n = 0 } finally { o = i = 0 } if (5 & t[0]) throw t[1]; return { value: t[0] ? t[1] : void 0, done: !0 } }([t, e]) } } } var s = "https://api.newyorker.de/public/countries", n = "de", i = "https://api.newyorker.de/csp/loyalty/", d = "https://api.newyorker.de/csp/customers", p = "https://api.newyorker.de/api", c = function (e) { this.objectId = e.objectId, this.username = e.username, this.email = e.email, this.emailVerified = e.emailVerified, this.loyalty = e.loyalty, this.sessionToken = e.sessionToken, this.countryCode = e.countryCode, this.createdAt = e.createdAt ? new Date(e.createdAt) : void 0, this.updatedAt = e.updatedAt ? new Date(e.updatedAt) : void 0, e.customerProfile && (this.customerProfile = new a(e.customerProfile)) }, a = function (e) { if (this.objectId = e.objectId, this.createdAt = e.createdAt ? new Date(e.createdAt) : void 0, this.updatedAt = e.updatedAt ? new Date(e.updatedAt) : void 0, this.email = e.email, this.firstName = e.firstName, this.lastName = e.lastName, this.phoneNumber = e.phoneNumber, this.storeId = e.storeId, this.image = e.image ? new o(e.image) : void 0, e.birthday && (this.birthday = new l(e.birthday)), e.address && (this.customerAddress = new u(e.address)), e.customerAddress && (this.customerAddress = new u(e.customerAddress)), e.sex) { var t = "" + e.sex; "N/A-SEX" === t && (t = "N/A"), this.sex = t } if (e.size) { var r = "" + e.size; "N/A-SIZE" === r && (r = "N/A"), this.size = r } e.modelProfile && (this.modelProfile = e.modelProfile) }, u = function (e) { this.objectId = e.objectId, this.__type = e.__type ? e.__type : void 0, this.className = e.className ? e.className : void 0, this.createdAt = e.createdAt ? new Date(e.createdAt) : void 0, this.updatedAt = e.updatedAt ? new Date(e.updatedAt) : void 0, this.city = e.city, this.country = e.country, this.postalCode = e.postalCode, this.street = e.street, e.geoLoc && (this.geoLoc = new r(e.geoLoc)) }, o = function (e) { this.__type = "File", this.name = e.name, this.url = e.url }, r = function (e) { this.coordinates = e.coordinates }, l = function (e) { this.__type = "Date", this.iso = e.iso ? new Date(e.iso) : new Date(e) }, m = function (e) { this.email = e.email, this.newsletterOnly = e.newsletterOnly, this.loyalty = e.loyalty, this.channels = e.channels }, y = function (e) { this.objectId = e.objectId, this.userId = e.userId, this.createdAt = e.createdAt, this.updatedAt = e.updatedAt, this.itemClassName = e.itemClassName, this.itemId = e.itemId }, f = function (e) { this.id = e.id, this.p4mId = e.p4mId, this.statusCode = e.statusCode, this.totalPoints = e.totalPoints, this.totalPointsCollected = e.totalPointsCollected, this.totalPointsUsed = e.totalPointsUsed, this.cards = [], e.cards && 0 < e.cards.length && (this.cards = e.cards.map(function (e) { return new b(e) })), this.coupons = [], e.coupons && 0 < e.coupons.length && (this.coupons = e.coupons.map(function (e) { return new v(e) })), this.rewards = [], e.rewards && 0 < e.rewards.length && (this.rewards = e.rewards.map(function (e) { return new w(e) })) }, b = function (e) { this.number = e.number, this.qrCode = e.qrCode, this.type = e.type, this.active = e.active, this.primary = e.primary }, v = function (e) { if (this.id = e.id, this.createDate = new Date(e.createDate), this.externalCode = e.externalCode, this.isAllDay = e.isAllDay, this.isUnlimited = e.isUnlimited, this.lastRedeemDate = e.lastRedeemDate ? new Date(e.lastRedeemDate) : null, this.redeemDependencyCode = e.redeemDependencyCode, this.validFrom = e.validFrom ? new Date(e.validFrom) : null, this.validTo = e.validTo ? new Date(e.validTo) : null, this.images = [], e.images && 0 < e.images.length && (this.images = e.images.map(function (e) { return new C(e) })), this.translations = {}, e.translations) for (var t in e.translations) if (e.translations.hasOwnProperty(t)) { var r = e.translations[t]; this.translations[t] = new g(r) } }, w = function (e) { if (this.id = e.id, this.createDate = new Date(e.createDate), this.externalCode = e.externalCode, this.decreasePoints = e.decreasePoints, this.isAllDay = e.isAllDay, this.isUnlimited = e.isUnlimited, this.lastRedeemDate = e.lastRedeemDate ? new Date(e.lastRedeemDate) : null, this.points = e.points, this.pointsNeeded = e.pointsNeeded, this.redeemDependencyCode = e.redeemDependencyCode, this.validFrom = e.validFrom ? new Date(e.validFrom) : null, this.validTo = e.validTo ? new Date(e.validTo) : null, this.images = [], e.images && 0 < e.images.length && (this.images = e.images.map(function (e) { return new C(e) })), this.translations = {}, e.translations) for (var t in e.translations) if (e.translations.hasOwnProperty(t)) { var r = e.translations[t]; this.translations[t] = new g(r) } }, C = function (e) { this.name = e.name, this.url = e.url, this.destinationUrl = e.destinationUrl, this.path = e.path, this.tags = e.tags }, g = function (e) { this.title = e.title, this.subtitle = e.subtitle, this.body = e.body }, S = function (e) { this.p4mId = e.p4mId, this.transactions = [], e.transactions && 0 < e.transactions.length && (this.transactions = e.transactions.map(function (e) { return new I(e) })) }, I = function (e) { this.code = e.code, this.date = new Date(e.date), this.points = e.points, this.storeId = e.storeId, this.storeName = e.storeName, this.typeCode = e.typeCode, this.subTypeCode = e.subTypeCode }, T = function (e) { this.p4mId = e.p4mId, this.shareId = e.shareId }, k = "NY_CUSTOMER_SERVICE", P = "NY-USER-TOKEN", A = "NY-USER-PROFILE", N = "NY-COUNTRY", D = function () { function e() { this.initialized = !1, this.currentCustomer = null, this.loyaltyData = null, this.loyaltyHistory = null, this.currentCountry = null, this.userSubscriberMap = {}, this.customerNaSubscriberMap = {}, this.loyaltyDataSubscriberMap = {}, this.loyaltyHistorySubscriberMap = {}, this.countrySubscriberMap = {}, this.currentCustomer = null, this.currentCountry = null, this.userSubscriberMap = {}, this.countrySubscriberMap = {}, this.loadCountry(), this.initCustomer() } return e.get = function () { var e = window[k]; return e || null }, e.prototype.initCustomer = function () { return t(this, void 0, void 0, function () { var t, r, s; return h(this, function (e) { switch (e.label) { case 0: return e.trys.push([0, 4, 5, 6]), [4, (t = this).loadCustomerFromApp()]; case 1: return t.currentCustomer = e.sent(), this.currentCustomer ? [3, 3] : (this.currentCustomer = this.loadCustomerFromSessionStorage(), this.currentCustomer ? [3, 3] : [4, (r = this).loadToken()]); case 2: r.currentCustomer = e.sent(), e.label = 3; case 3: return this.currentCustomer && (this.notifyUserSubscribers(this.currentCustomer), this.loadUserData(!1)), [3, 6]; case 4: return s = e.sent(), console.error("[customer-service] error while initializing customer: ", s), [3, 6]; case 5: return this.initialized = !0, this.currentCustomer || this.notifyCustomerNaSubscribers(), [7]; case 6: return [2] } }) }) }, e.prototype.subscribeForUser = function (e, t) { this.currentCustomer && t(this.currentCustomer), this.userSubscriberMap[e] = t }, e.prototype.subscribeForCustomerNotAvailable = function (e, t) { this.initialized && !this.currentCustomer && t(), this.customerNaSubscriberMap[e] = t }, e.prototype.subscribeForCountry = function (e, t) { t(this.currentCountry), this.countrySubscriberMap[e] = t }, e.prototype.setCurrentCountry = function (e) { "string" == typeof e && 2 === e.length && this.currentCountry !== e && (this.currentCountry = e, localStorage.setItem(N, this.currentCountry), this.notifyCountrySubscribers(this.currentCountry)) }, e.prototype.getLoyaltyData = function (n) { return t(this, void 0, void 0, function () { var t, r, s, o; return h(this, function (e) { switch (e.label) { case 0: if (!n && this.loyaltyData) return [2, this.loyaltyData]; if (!(this.currentCustomer && this.currentCustomer.objectId && this.currentCustomer.sessionToken)) return [3, 5]; e.label = 1; case 1: return e.trys.push([1, 4, , 5]), t = "" + i + this.currentCustomer.objectId + "/details", this.isInternetExplorer() && (t += "?t=" + new Date), [4, fetch(t, { headers: { "NY-SESSION-ID": "" + this.currentCustomer.sessionToken, "Content-Type": "application/json", "Cache-Control": "no-cache" } })]; case 2: if (!(r = e.sent()).ok) throw new Error("response was not ok: " + r.statusText); return [4, r.json()]; case 3: return s = e.sent(), this.loyaltyData = new f(s), this.notifyLoyaltyDataSubscribers(s), [2, this.loyaltyData]; case 4: throw o = e.sent(), console.error("[customer-service] error loading loyalty-data: ", o), o; case 5: return [2, null] } }) }) }, e.prototype.getHistory = function () { return t(this, void 0, void 0, function () { var t, r, s, o; return h(this, function (e) { switch (e.label) { case 0: if (!(this.currentCustomer && this.currentCustomer.objectId && this.currentCustomer.sessionToken)) return [3, 5]; e.label = 1; case 1: return e.trys.push([1, 4, , 5]), t = "" + i + this.currentCustomer.objectId + "/history", this.isInternetExplorer() && (t += "?t=" + new Date), [4, fetch(t, { headers: { "NY-SESSION-ID": "" + this.currentCustomer.sessionToken, "Content-Type": "application/json", "Cache-Control": "no-cache" } })]; case 2: if (!(r = e.sent()).ok) throw new Error("response was not ok: " + r.statusText); return [4, r.json()]; case 3: return s = e.sent(), this.loyaltyHistory = new S(s), this.notifyLoyaltyHistorySubscribers(s), [2, this.loyaltyHistory]; case 4: return o = e.sent(), console.error("[customer-service] error while loading loyalty-history: ", o), [3, 5]; case 5: return [2, null] } }) }) }, e.prototype.subscribeForLoyaltyData = function (e, t) { this.loyaltyData && t(this.loyaltyData), this.loyaltyDataSubscriberMap.keys ? this.loyaltyDataSubscriberMap[e] = t : (this.loyaltyDataSubscriberMap[e] = t, this.getLoyaltyData(!0)) }, e.prototype.subscribeForLoyaltyHistory = function (e, t) { this.loyaltyHistory && t(this.loyaltyHistory), this.loyaltyHistorySubscriberMap.keys ? this.loyaltyHistorySubscriberMap[e] = t : (this.loyaltyHistorySubscriberMap[e] = t, this.getHistory()) }, e.prototype.getReferralId = function () { return t(this, void 0, void 0, function () { var t, r, s; return h(this, function (e) { switch (e.label) { case 0: if (!(this.currentCustomer && this.currentCustomer.objectId && this.currentCustomer.sessionToken)) return [3, 5]; e.label = 1; case 1: return e.trys.push([1, 4, , 5]), [4, fetch("" + i + this.currentCustomer.objectId + "/shareId", { headers: { "NY-SESSION-ID": "" + this.currentCustomer.sessionToken, "Content-Type": "application/json", "Cache-Control": "no-cache" } })]; case 2: return (t = e.sent()).ok || console.error("[customer-service] error while loading loyalty-shareId"), [4, t.json()]; case 3: return r = e.sent(), [2, new T(r)]; case 4: return s = e.sent(), console.error("[customer-service] error while loading loyalty-shareId: ", s), [3, 5]; case 5: return [2, null] } }) }) }, e.prototype.registerUser = function (i) { return t(this, void 0, void 0, function () { var t, r, s, o, n; return h(this, function (e) { switch (e.label) { case 0: return e.trys.push([0, 5, , 6]), t = p + "/functions/registerCustomer", r = { username: i.email, password: i.password, email: i.email, firstName: i.firstName, lastName: i.lastName, country: i.countryCode, optInEmailAdvertisementConsent: i.optInEmailAdvertisementConsent, optInEmailChannelLoyalty: i.optInEmailChannelLoyalty, optInEmailChannelNewsletter: i.optInEmailChannelNewsletter }, i.shareId && (r.shareId = i.shareId), i.postalCode && (r.postalCode = i.postalCode), [4, fetch(t, { body: JSON.stringify(r), cache: "no-cache", headers: { "X-Parse-Application-Id": "newYorkerApi", "content-type": "application/json" }, method: "POST" })]; case 1: return (s = e.sent()).ok ? [4, s.json()] : [3, 4]; case 2: return (o = e.sent()).error ? [2, !1] : (this.currentCustomer = new c({}), this.currentCustomer.objectId = o.result.userId, this.currentCustomer.sessionToken = o.result.sessionToken, i.saveLogin && this.saveLogin(this.currentCustomer), this.notifyUserSubscribers(this.currentCustomer), [4, this.loadUserData(!0)]); case 3: return e.sent(), [2, !0]; case 4: return [3, 6]; case 5: return n = e.sent(), console.error("[customer-service] error while registering customer: ", n), [3, 6]; case 6: return [2, !1] } }) }) }, e.prototype.acceptLoyalty = function (o) { return void 0 === o && (o = null), t(this, void 0, void 0, function () { var t, r, s; return h(this, function (e) { switch (e.label) { case 0: return e.trys.push([0, 4, , 5]), t = {}, o && (t.shareId = o), this.currentCustomer && this.currentCustomer.sessionToken ? [4, fetch(p + "/functions/acceptLoyalty", { body: JSON.stringify(t), cache: "no-cache", headers: { "X-Parse-Application-Id": "newYorkerApi", "content-type": "application/json", "X-Parse-Session-Token": this.currentCustomer.sessionToken }, method: "POST" })] : [2, !1]; case 1: return (r = e.sent()).ok ? [4, r.json()] : [3, 3]; case 2: return e.sent().error ? [2, !1] : (this.loadUserData(!0), [2, !0]); case 3: return [3, 5]; case 4: return s = e.sent(), console.error("[customer-service] error while accepting loyalty: ", s), [3, 5]; case 5: return [2, !1] } }) }) }, e.prototype.createOrUpdateCustomerProfile = function (i) { return t(this, void 0, void 0, function () { var t, r, s, o, n; return h(this, function (e) { switch (e.label) { case 0: return e.trys.push([0, 2, , 3]), i && this.currentCustomer ? (t = new a(i), (r = {})[this.currentCustomer.objectId] = { read: !0, write: !0 }, t.ACL = r, s = null, this.currentCustomer && this.currentCustomer.customerProfile && this.currentCustomer.customerProfile.objectId && (s = this.currentCustomer.customerProfile.objectId), o = p + "/classes/CustomerProfile", s && (o = o + "/" + s), [4, fetch(o, { body: JSON.stringify(t), headers: { "X-Parse-Application-Id": "newYorkerApi", "content-type": "application/json", "X-Parse-Session-Token": this.currentCustomer.sessionToken }, method: s ? "PUT" : "POST" })]) : [2, !1]; case 1: return e.sent().ok ? (this.refreshUser(), [2, !0]) : (console.error("[customer-service] error while creating or updating customer-profile."), [3, 3]); case 2: return n = e.sent(), console.error("[customer-service] error while creating or updating customer-profile: ", n), [3, 3]; case 3: return [2, !1] } }) }) }, e.prototype.createOrUpdateCustomerAddress = function (c) { return t(this, void 0, void 0, function () { var t, r, s, o, n, i, a; return h(this, function (e) { switch (e.label) { case 0: return e.trys.push([0, 4, , 5]), this.currentCustomer && this.currentCustomer.customerProfile ? (t = this.currentCustomer.customerProfile, r = new u(c), s = !(!t.customerAddress || !t.customerAddress.objectId) && t.customerAddress.objectId, o = p + "/classes/CustomerAddress", s && (o = o + "/" + s), [4, fetch(o, { body: JSON.stringify(r), headers: { "X-Parse-Application-Id": "newYorkerApi", "content-type": "application/json", "X-Parse-Session-Token": this.currentCustomer.sessionToken }, method: s ? "PUT" : "POST" })]) : [2, !1]; case 1: return (n = e.sent()).ok ? [4, n.json()] : [3, 3]; case 2: if ((i = e.sent()).objectId) return [2, this.createOrUpdateCustomerProfile({ address: { __type: "Pointer", className: "CustomerAddress", objectId: i.objectId } })]; if (i.updatedAt) return this.refreshUser(), [2, !0]; e.label = 3; case 3: return console.error("[customer-service] error while creating or updating customer-address."), [3, 5]; case 4: return a = e.sent(), console.error("[customer-service] error while creating or updating customer-address: ", a), [3, 5]; case 5: return [2, !1] } }) }) }, e.prototype.loginUser = function (n, i, a) { return void 0 === a && (a = !1), t(this, void 0, void 0, function () { var t, r, s, o; return h(this, function (e) { switch (e.label) { case 0: return e.trys.push([0, 4, , 5]), t = { username: n, password: i }, [4, fetch(p + "/login", { body: JSON.stringify(t), cache: "no-cache", headers: { "X-Parse-Application-Id": "newYorkerApi", "content-type": "application/json" }, method: "POST" })]; case 1: return (r = e.sent()).ok ? [4, r.json()] : [3, 3]; case 2: return (s = e.sent()).error ? (console.error("[customer-service] error while logging in: ", s.error), [2, !1]) : (this.currentCustomer = new c(s), this.notifyUserSubscribers(this.currentCustomer), a && this.saveLogin(this.currentCustomer), this.loadUserData(!0), [2, !0]); case 3: return console.error("[customer-service] error while logging in: ", r.statusText), [3, 5]; case 4: return o = e.sent(), console.error("[customer-service] error while logging in: ", o), [3, 5]; case 5: return [2, !1] } }) }) }, e.prototype.logout = function () { return t(this, void 0, void 0, function () { var t, r, s, o; return h(this, function (e) { switch (e.label) { case 0: t = this.currentCustomer.sessionToken, r = p + "/logout", e.label = 1; case 1: return e.trys.push([1, 3, , 4]), [4, fetch(r, { method: "POST", headers: { "X-Parse-Session-Token": t, "X-Parse-Application-Id": "newYorkerApi", "content-type": "application/json" } })]; case 2: return s = e.sent(), this.removeUserInLocalStorage(), s.ok ? [2, !0] : (console.error("[customer-service] error while logging out: ", s.statusText), [3, 4]); case 3: return o = e.sent(), console.error("[customer-service] error while logging out: ", o), [3, 4]; case 4: return [2, !1] } }) }) }, e.prototype.signupModelCasting = function (s) { return t(this, void 0, void 0, function () { var t, r; return h(this, function (e) { switch (e.label) { case 0: return e.trys.push([0, 2, , 3]), [4, fetch(d + "/model-casting/signup", { credentials: "omit", method: "POST", body: s })]; case 1: if ((t = e.sent()).ok) return [2, !0]; throw console.error("[customer-service] error while signing-uo for model-casting: ", t.statusText), "[customer-service] error while signing-uo for model-casting: " + t.statusText; case 2: throw r = e.sent(), console.error("[customer-service] error while signing-uo for model-casting: ", r), r; case 3: return [2] } }) }) }, e.prototype.subscribeForNewsletter = function (o, n, i, a, c, u, l) { return t(this, void 0, void 0, function () { var t, r, s; return h(this, function (e) { switch (e.label) { case 0: t = { email: o, countryCode: n, birthday: i, optInEmailAdvertisementConsent: a, optInEmailChannelNewsletter: c, optInEmailChannelLoyalty: !1, optInEmailChannelWomensFashion: u, optInEmailChannelMensFashion: l }, e.label = 1; case 1: return e.trys.push([1, 3, , 4]), [4, fetch(d + "/customer/newsletter/register", { credentials: "omit", method: "POST", body: JSON.stringify(t), headers: { "Content-Type": "application/json" } })]; case 2: return (r = e.sent()).ok ? [2, !0] : (console.error("[customer-service] error while subscribing for newsletter: ", r.statusText), [3, 4]); case 3: return s = e.sent(), console.error("[customer-service] error while subscribing for newsletter: ", s), [3, 4]; case 4: return [2, !1] } }) }) }, e.prototype.resendVerificationEmail = function () { return t(this, void 0, void 0, function () { var t, r, s, o; return h(this, function (e) { switch (e.label) { case 0: if (!(this.currentCustomer && this.currentCustomer.sessionToken && this.currentCustomer.email)) return [3, 4]; t = this.currentCustomer.sessionToken, r = d + "/customer/" + this.currentCustomer.objectId + "/resend-verification-mail", e.label = 1; case 1: return e.trys.push([1, 3, , 4]), [4, fetch(r, { method: "POST", headers: { "NY-SESSION-ID": t, "content-type": "application/json" } })]; case 2: return (s = e.sent()).ok ? [2, !0] : (console.error("[customer-service] error while resending verification mail: ", s.statusText), [3, 4]); case 3: return o = e.sent(), console.error("[customer-service] error while resending verification mail: ", o), [3, 4]; case 4: return [2, !1] } }) }) }, e.prototype.uploadAvatarImage = function (u, l) { return t(this, void 0, void 0, function () { var t, r, s, o, n, i, a, c; return h(this, function (e) { switch (e.label) { case 0: if (l && (l = "profile_image.jpg"), !(this.currentCustomer && this.currentCustomer.sessionToken && u)) return [3, 6]; t = this.currentCustomer.sessionToken, r = p + "/files/" + l, e.label = 1; case 1: return e.trys.push([1, 5, , 6]), [4, fetch(r, { method: "POST", headers: { "X-Parse-Session-Token": t, "X-Parse-Application-Id": "newYorkerApi", "content-type": "image/jpg" }, body: u })]; case 2: return (s = e.sent()).ok ? [4, s.json()] : [3, 4]; case 3: return o = e.sent(), n = o.url, i = o.name, n && i ? (a = { __type: "File", name: i, url: n }, [2, this.createOrUpdateCustomerProfile({ image: a })]) : (console.error("[customer-service] error while uploading avatar image: ", o), [2, !1]); case 4: return console.error("[customer-service] error while uploading avatar image: ", s.statusText), [3, 6]; case 5: return c = e.sent(), console.error("[customer-service] error while uploading avatar image: ", c), [3, 6]; case 6: return [2, !1] } }) }) }, e.prototype.deleteProfile = function () { return t(this, void 0, void 0, function () { var t, r, s, o; return h(this, function (e) { switch (e.label) { case 0: return e.trys.push([0, 2, , 3]), t = this.currentCustomer.sessionToken, r = p + "/users/" + this.currentCustomer.objectId, [4, fetch(r, { method: "DELETE", headers: { "X-Parse-Session-Token": t, "X-Parse-Application-Id": "newYorkerApi" } })]; case 1: return (s = e.sent()).ok ? (this.removeUserInLocalStorage(), [2, !0]) : (console.error("[customer-service] error while uploading avatar image: ", s.statusText), [3, 3]); case 2: return o = e.sent(), console.error("[customer-service] error while uploading avatar image: ", o), [3, 3]; case 3: return [2, !1] } }) }) }, e.prototype.removeUserInLocalStorage = function () { try { sessionStorage.removeItem(A) } catch (e) { console.error("[customer-service] not able to delete user from session storage", e) } try { localStorage.removeItem(P) } catch (e) { console.error("[customer-service] not able to delete user from local storage", e) } this.currentCustomer = null, this.loyaltyData = null, this.loyaltyHistory = null, this.notifyUserSubscribers(this.currentCustomer) }, e.prototype.refreshUser = function () { return t(this, void 0, void 0, function () { return h(this, function (e) { return this.loadUserData(!0), [2] }) }) }, e.prototype.loadToken = function () { return t(this, void 0, void 0, function () { var t; return h(this, function (e) { return (t = JSON.parse(localStorage.getItem(P))) ? [2, this.currentCustomer = t] : [2, null] }) }) }, e.prototype.storeUser = function (e) { var t = JSON.stringify(e); sessionStorage.setItem(A, t) }, e.prototype.loadUserData = function (a) { return t(this, void 0, void 0, function () { var t, r, s, o, n, i; return h(this, function (e) { switch (e.label) { case 0: return e.trys.push([0, 4, , 5]), t = void 0, a || (t = this.loadCustomerFromSessionStorage()), t ? (this.currentCustomer = t, [3, 3]) : [3, 1]; case 1: return r = this.currentCustomer.objectId, s = this.currentCustomer.sessionToken, [4, (o = this).loadUserFromToken(r, s)]; case 2: o.currentCustomer = e.sent(), e.label = 3; case 3: return this.currentCustomer.countryCode && this.setCurrentCountry(this.currentCustomer.countryCode), this.notifyUserSubscribers(this.currentCustomer), this.storeUser(this.currentCustomer), "function" == typeof Event ? n = new Event("ny_user_updated") : (n = document.createEvent("Event")).initEvent("ny_user_updated", !0, !0), window.dispatchEvent(n), [2, this.currentCustomer]; case 4: throw i = e.sent(), console.error("[customer-service] while loading customer", i), i; case 5: return [2] } }) }) }, e.prototype.loadUserFromToken = function (s, o) { return t(this, void 0, void 0, function () { var t, r; return h(this, function (e) { switch (e.label) { case 0: return [4, fetch(p + "/users/" + s + "?include=customerProfile&include=country&include=customerProfile.customerAddress&include=customerProfile.modelProfile", { headers: { "X-Parse-Session-Token": o, "X-Parse-Application-Id": "newYorkerApi", "content-type": "application/json" } })]; case 1: if (!(t = e.sent()).ok) throw new Error("error in response: " + t.statusText); return [4, t.json()]; case 2: if ((r = e.sent()).error) throw new Error("error in response: " + r.error); return [2, new c(r)] } }) }) }, e.prototype.notifyUserSubscribers = function (e) { for (var t in this.userSubscriberMap) if (this.userSubscriberMap.hasOwnProperty(t)) try { this.userSubscriberMap[t](e) } catch (e) { console.error("[customer-service] bad user-subscriber: ", e) } }, e.prototype.notifyCustomerNaSubscribers = function () { for (var e in this.customerNaSubscriberMap) if (this.customerNaSubscriberMap.hasOwnProperty(e)) try { this.customerNaSubscriberMap[e]() } catch (e) { console.error("[customer-service] bad customerNA-subscriber: ", e) } }, e.prototype.notifyLoyaltyDataSubscribers = function (e) { for (var t in this.loyaltyDataSubscriberMap) if (this.loyaltyDataSubscriberMap.hasOwnProperty(t)) try { this.loyaltyDataSubscriberMap[t](e) } catch (e) { console.error("[customer-service] bad loyalty-data-subscriber: ", e) } }, e.prototype.notifyLoyaltyHistorySubscribers = function (e) { for (var t in this.loyaltyHistorySubscriberMap) if (this.loyaltyHistorySubscriberMap.hasOwnProperty(t)) try { this.loyaltyHistorySubscriberMap[t](e) } catch (e) { console.error("[customer-service] bad loyalty-history-subscriber: ", e) } }, e.prototype.notifyCountrySubscribers = function (r) { return t(this, void 0, void 0, function () { var t; return h(this, function (e) { for (t in this.countrySubscriberMap) if (this.countrySubscriberMap.hasOwnProperty(t)) try { this.countrySubscriberMap[t](r) } catch (e) { console.error("[customer-service] bad country-subscriber:", e) } return [2] }) }) }, e.prototype.saveLogin = function (e) { var t = JSON.stringify(e); localStorage.setItem(P, t) }, e.prototype.loadCountry = function () { try { var e = localStorage.getItem(N); e && (this.currentCountry = e, this.notifyCountrySubscribers(this.currentCountry)) } catch (e) { console.error("[customer-service] error while loading country:", e) } }, e.prototype.loadCustomerFromApp = function () { return t(this, void 0, void 0, function () { var t, r, s; return h(this, function (e) { switch (e.label) { case 0: return window && window.NY_APP_USER_CONTEXT ? (t = window.NY_APP_USER_CONTEXT, r = t.userId(), s = t.sessionToken(), r && s ? [4, this.loadUserFromToken(r, s)] : [3, 2]) : [3, 4]; case 1: return [2, e.sent()]; case 2: console.warn("[customer-service] no app login"), e.label = 3; case 3: return [3, 5]; case 4: console.warn("[customer-service] no NY_APP_USER_CONTEXT present, falling back to local storage"), e.label = 5; case 5: return [2, null] } }) }) }, e.prototype.loadCustomerFromSessionStorage = function () { try { var e = sessionStorage.getItem(A); if (e) return new c(JSON.parse(e)) } catch (e) { console.error("[customer-service] error loading customer from sessionStorage: ", e) } return null }, e.prototype.loadCustomerEmailChannels = function (o) { return t(this, void 0, void 0, function () { var t, r, s; return h(this, function (e) { switch (e.label) { case 0: return e.trys.push([0, 4, , 5]), [4, fetch(d + "/customer/" + o + "/channels", { credentials: "omit", method: "GET", headers: { "Content-Type": "application/json" } })]; case 1: return (t = e.sent()).ok ? [4, t.json()] : [3, 3]; case 2: return r = e.sent(), [2, new m(r)]; case 3: return console.error("[customer-service] error while loading customer email channels: ", t.statusText), [3, 5]; case 4: return s = e.sent(), console.error("[customer-service] error while loading customer email channels: ", s), [3, 5]; case 5: return [2, null] } }) }) }, e.prototype.updateCustomerEmailChannels = function (o, n, i, a, c) { return t(this, void 0, void 0, function () { var t, r, s; return h(this, function (e) { switch (e.label) { case 0: t = { optInEmailChannelNewsletter: n, optInEmailChannelLoyalty: i, optInEmailChannelWomensFashion: !!a, optInEmailChannelMensFashion: !!c }, e.label = 1; case 1: return e.trys.push([1, 3, , 4]), [4, fetch(d + "/customer/" + o + "/channels", { credentials: "omit", method: "PUT", body: JSON.stringify(t), headers: { "Content-Type": "application/json" } })]; case 2: return (r = e.sent()).ok ? [2, !0] : (console.error("[customer-service] error while updating customer email channels: ", r.statusText), [3, 4]); case 3: return s = e.sent(), console.error("[customer-service] error while updating customer email channels: ", s), [3, 4]; case 4: return [2, !1] } }) }) }, e.prototype.optOutAllCustomerEmailChannels = function (s) { return t(this, void 0, void 0, function () { var t, r; return h(this, function (e) { switch (e.label) { case 0: return e.trys.push([0, 2, , 3]), [4, fetch(d + "/customer/" + s + "/opt-out", { credentials: "omit", method: "POST", headers: { "Content-Type": "application/json" } })]; case 1: return (t = e.sent()).ok ? [2, !0] : (console.error("[customer-service] error while updating customer email channels: ", t.statusText), [3, 3]); case 2: return r = e.sent(), console.error("[customer-service] error while updating customer email channels: ", r), [3, 3]; case 3: return [2, !1] } }) }) }, e.prototype.likeProduct = function (o, n) { return t(this, void 0, void 0, function () { var t, r, s; return h(this, function (e) { switch (e.label) { case 0: t = p + "/functions/like", e.label = 1; case 1: return e.trys.push([1, 3, , 4]), [4, fetch(t, { headers: { "Content-Type": "application/json", "X-Parse-Application-Id": "newYorkerApi", "X-Parse-Session-Token": this.currentCustomer.sessionToken }, method: "POST", body: JSON.stringify({ class_name: "ProductExternal", objectId: o + "_" + n }) })]; case 2: return (r = e.sent()).ok ? [2, !0] : (console.error("[customer-service] error while liking product for customer", r.statusText), [3, 4]); case 3: return s = e.sent(), console.error("[customer-service] error while liking product for customer", s), [3, 4]; case 4: return [2, !1] } }) }) }, e.prototype.dislikeProduct = function (o, n) { return t(this, void 0, void 0, function () { var t, r, s; return h(this, function (e) { switch (e.label) { case 0: t = p + "/functions/dislike", e.label = 1; case 1: return e.trys.push([1, 3, , 4]), [4, fetch(t, { headers: { "Content-Type": "application/json", "X-Parse-Application-Id": "newYorkerApi", "X-Parse-Session-Token": this.currentCustomer.sessionToken }, method: "POST", body: JSON.stringify({ class_name: "ProductExternal", objectId: o + "_" + n }) })]; case 2: return (r = e.sent()).ok ? [2, !0] : (console.error("[customer-service] error while disliking product for customer", r.statusText), [3, 4]); case 3: return s = e.sent(), console.error("[customer-service] error while disliking product for customer: ", s), [3, 4]; case 4: return [2, !1] } }) }) }, e.prototype.getLikesForCustomer = function () { return t(this, void 0, void 0, function () { var t, r, s; return h(this, function (e) { switch (e.label) { case 0: return e.trys.push([0, 4, , 5]), t = JSON.stringify({ userId: this.currentCustomer.objectId, itemClassName: "ProductExternal" }), [4, fetch(p + "/classes/Like?where=" + t, { headers: { "Content-Type": "application/json", "X-Parse-Application-Id": "newYorkerApi", "X-Parse-Session-Token": this.currentCustomer.sessionToken }, method: "GET" })]; case 1: return (r = e.sent()).ok ? [4, r.json()] : [3, 3]; case 2: return [2, e.sent().results.map(function (e) { return new y(e) })]; case 3: return console.error("[customer-service] error while loading likes for customer: ", r.statusText), [3, 5]; case 4: return s = e.sent(), console.error("[customer-service] error while loading likes for customer: ", s), [3, 5]; case 5: return [2, []] } }) }) }, e.prototype.isInternetExplorer = function () { return "Microsoft Internet Explorer" == navigator.appName || !(!navigator.userAgent.match(/Trident/) && !navigator.userAgent.match(/rv:11/)) }, e }(), E = function (e) { this.iso_3166 = e.iso_3166, this.iso_639 = e.iso_639, this.ny_iso = e.ny_iso, this.name = e.name, this.localized_name = e.localized_name, this.currency = e.currency, this.region = e.region, this.app = e.app, this.loyalty = e.loyalty }, O = "NY_COUNTRY_SERVICE", e = function () { function e() { this.subscribers = {}; var e = D.get(); e && (this.customerService = e, this.customerService.subscribeForCountry("NY-COUNTRY-SWITCHER", this.countryCallback.bind(this))) } return e.get = function () { var e = window[O]; return e || null }, e.prototype.countryCallback = function (u) { return t(this, void 0, void 0, function () { var t, r, s, o, n, i, a, c; return h(this, function (e) { switch (e.label) { case 0: if (!u) return [3, 5]; e.label = 1; case 1: return e.trys.push([1, 3, , 4]), [4, this.getCountries()]; case 2: s = e.sent(), o = void 0; try { for (n = function (e) { var t = "function" == typeof Symbol && e[Symbol.iterator], r = 0; return t ? t.call(e) : { next: function () { return e && r >= e.length && (e = void 0), { value: e && e[r++], done: !e } } } }(s), i = n.next(); !i.done; i = n.next())if ((a = i.value).iso_3166 === u) { o = a; break } } catch (e) { t = { error: e } } finally { try { i && !i.done && (r = n.return) && r.call(n) } finally { if (t) throw t.error } } return o && (this.currentCountry = o, this.notifySubscribers(this.currentCountry)), [3, 4]; case 3: return c = e.sent(), console.log("[country-service] error while loading country: ", c), [3, 4]; case 4: return [3, 6]; case 5: this.currentCountry = null, e.label = 6; case 6: return [2] } }) }) }, e.prototype.getCountries = function () { return t(this, void 0, void 0, function () { var t; return h(this, function (e) { switch (e.label) { case 0: return this.countries ? [3, 2] : [4, (t = this).loadCountries()]; case 1: t.countries = e.sent(), e.label = 2; case 2: return [2, this.countries] } }) }) }, e.prototype.loadCountries = function () { return t(this, void 0, void 0, function () { var t, r; return h(this, function (e) { switch (e.label) { case 0: return e.trys.push([0, 4, , 5]), [4, fetch(s)]; case 1: return (t = e.sent()).ok ? [4, t.json()] : [3, 3]; case 2: return [2, e.sent().map(function (e) { return new E(e) })]; case 3: return [3, 5]; case 4: return r = e.sent(), console.error("[country-service] loading countries failed: ", r), [3, 5]; case 5: return [2, []] } }) }) }, e.prototype.subscribeForCurrentCountry = function (e, t) { this.subscribers[e] = t, void 0 !== this.currentCountry && t(this.currentCountry) }, e.prototype.notifySubscribers = function (e) { for (var t in this.subscribers) if (this.subscribers.hasOwnProperty(t)) try { this.subscribers[t](e) } catch (e) { console.log("[country-service] bad subscriber: ", e) } }, e.prototype.setCurrentCountry = function (e) { this.customerService && this.customerService.setCurrentCountry(e.iso_3166) }, e.prototype.getCountryCodeFromLocation = function () { var e = this.getPath().split("/"), t = n; return e && 0 < e.length && (!(t = e[0]) || "" === t || t.startsWith("host") || 2 < t.length) && (t = n), t }, e.prototype.routeToCountry = function (e) { if (e && 2 === e.length) { var t = this.getBaseUrl(), r = this.getPath().split("/"); if (r && 0 < r.length) { var s = r[0], o = void 0; if (0 == s.indexOf("host")) return; if (!s || "" === s || 2 < s.length) { if (e.toLowerCase() === n) return; console.log("no country code in url"), o = e + "/" + r.join("/") } else e.toLowerCase() === n ? r.shift() : r[0] = e.toLowerCase(), o = r.join("/"); window.location.href = t + o } } }, e.prototype.getBaseUrl = function () { var e = window.location.href; if (0 <= e.indexOf("/victor/preview/")) { var t = e.indexOf("/victor/preview/") + 16, r = e.substr(t).indexOf("/") + 1; return e.substr(0, t + r) } return e.substr(0, e.indexOf("newyorker.de/") + 13) }, e.prototype.getPath = function () { var e = window.location.href; if (0 <= e.indexOf("/victor/preview/")) { var t = e.indexOf("/victor/preview/") + 16, r = e.substr(t).indexOf("/") + 1; return e.substr(t + r) } return e.substr(e.indexOf("newyorker.de/") + 13) }, e }(); window[k] || (window[k] = new D), window[O] || (window[O] = new e) }();
//# sourceMappingURL=web-site-service.js.map